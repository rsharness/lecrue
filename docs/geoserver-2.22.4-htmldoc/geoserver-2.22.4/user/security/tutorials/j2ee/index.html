
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Configuring J2EE Authentication &#8212; GeoServer 2.22.4 User Manual</title>
    <link rel="stylesheet" href="../../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="../../../_static/blueprint/print.css" type="text/css" media="print" /> 
    <!--[if IE]>
    <link rel="stylesheet" href="../../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/default.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/geoserver.ico"/>
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Configuring HTTP Header Proxy Authentication" href="../httpheaderproxy/index.html" />
    <link rel="prev" title="Configuring X.509 Certificate Authentication" href="../cert/index.html" /> 
  </head><body class="security/tutorials/j2ee/index">
<div id="header" class="selfclear">
    <div class="wrap selfclear">
        <div id="logo"><a href="http://geoserver.org">GeoServer</a></div>
        <ul id="top-nav">
            <li class="first"><a href="http://geoserver.org/about/">About</a></li>
            <li><a href="http://geoserver.org/blog">Blog</a></li>
            <li><a href="http://geoserver.org/download/">Download</a></li>
            <li><a href="https://docs.geoserver.org/">Documentation</a></li>
        </ul>

        <form id="quick-search" action="../../../search.html" method="get">
            <fieldset>
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
                <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" size="20" tabindex="3" placeholder="Search User Manual&hellip;" />
                <input id="quick-search-submit" type="image" value="Search" src="../../../_static/chrome/search_icon_green.png" />
            </fieldset>
        </form>
    </div><!-- /.wrap -->
</div><!-- /#header -->
    <div id="main">
      <div class="wrap selfclear">
        <div id="content-left" class="content-border"></div>
        <div id="content">
        
<ul id="breadcrumbs">
  
    <li><a href="../../../index.html">GeoServer 2.22.4 User Manual</a> &raquo;</li>
        <li><a href="../../index.html" accesskey="U">Security</a> &raquo;</li>
        <li><a href="../index.html" accesskey="U">Tutorials</a> &raquo;</li>
    <li>Configuring J2EE Authentication</li>
</ul>
        
<ul id="relatedlinks" class="selfclear">
  <li class="first"><a href="../httpheaderproxy/index.html" title="Configuring HTTP Header Proxy Authentication" accesskey="N">Next</a></li>
  <li>
    <a href="../cert/index.html" title="Configuring X.509 Certificate Authentication" accesskey="P">Previous</a>|
  </li>
</ul>
          
  <div class="section" id="configuring-j2ee-authentication">
<span id="security-tutorials-j2ee"></span><h1>Configuring J2EE Authentication<a class="headerlink" href="#configuring-j2ee-authentication" title="Permalink to this headline">¶</a></h1>
<p>Servlet containers such as Tomcat and Jetty offer their own options for
authentication. Often it is desirable for an application such as GeoServer
to use that existing authentication mechanisms rather than require its own
authentication configuration.</p>
<p>J2EE authentication allows GeoServer to delegate to the servlet container for
authentication. This tutorial walks through the process of setting up J2EE
authentication.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>This tutorial requires a servlet container capable of doing its own authentication.
This tutorial uses Tomcat.</p>
<p>Deploy GeoServer in tomcat before proceeding.</p>
</div>
<div class="section" id="configure-the-j2ee-authentication-filter">
<h2>Configure the J2EE authentication filter<a class="headerlink" href="#configure-the-j2ee-authentication-filter" title="Permalink to this headline">¶</a></h2>
<p>In order to delegate to the container for authentication a filter must first be
configured to recognize the container authentication.</p>
<ol class="arabic">
<li><p>Login to the GeoServer web admin interface as the <code class="docutils literal notranslate"><span class="pre">admin</span></code> user.</p></li>
<li><p>Click the <code class="docutils literal notranslate"><span class="pre">Authentication</span></code> link located under the <code class="docutils literal notranslate"><span class="pre">Security</span></code> section of
the navigation sidebar.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee1.jpg" src="../../../_images/j2ee1.jpg" />
</div>
</li>
<li><p>Scroll down to the <code class="docutils literal notranslate"><span class="pre">Authentication</span> <span class="pre">Filter</span></code> panel and click the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">new</span></code> link.</p></li>
<li><p>Create a new filter named “j2ee” and fill out the settings form
as follows:</p>
<ul class="simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">Role</span> <span class="pre">service</span></code> to “default”</p></li>
</ul>
<div class="figure align-center">
<img alt="../../../_images/j2ee2.jpg" src="../../../_images/j2ee2.jpg" />
</div>
</li>
<li><p>Save</p></li>
<li><p>Back on the authentication page scroll down to the <code class="docutils literal notranslate"><span class="pre">Filter</span> <span class="pre">Chains</span></code> panel.</p></li>
<li><p>Select “Web UI” from the <code class="docutils literal notranslate"><span class="pre">Request</span> <span class="pre">type</span></code> drop down.</p></li>
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">j2ee</span></code> filter and position it after the <code class="docutils literal notranslate"><span class="pre">anonymous</span></code> filter.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee3.jpg" src="../../../_images/j2ee3.jpg" />
</div>
</li>
<li><p>Save.</p></li>
</ol>
</div>
<div class="section" id="configure-the-role-service">
<h2>Configure the role service<a class="headerlink" href="#configure-the-role-service" title="Permalink to this headline">¶</a></h2>
<p>Since it is not possible to ask a J2EE container for the roles of a principal it is
necessary to have all J2EE roles enlisted in a role service. The only J2EE API GeoServer
can use is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">class</span><span class="p">:</span> <span class="n">javax</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">HttpServletRequest</span>
<span class="n">method</span><span class="p">:</span> <span class="n">boolean</span> <span class="n">isUserInRole</span><span class="p">(</span><span class="n">String</span> <span class="n">role</span><span class="p">)</span>
</pre></div>
</div>
<p>The idea is to query all roles from the role service and test each role with the “isUserInRole” method.</p>
<p>This tutorial assumes a user named “admin” with password “password” and a J2EE role named “tomcat”.</p>
<ol class="arabic">
<li><p>Click the <code class="docutils literal notranslate"><span class="pre">Users,</span> <span class="pre">Groups,</span> <span class="pre">and</span> <span class="pre">Roles</span></code> link located under the <code class="docutils literal notranslate"><span class="pre">Security</span></code> section of
the navigation sidebar.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee5.jpg" src="../../../_images/j2ee5.jpg" />
</div>
</li>
<li><p>Click on <code class="docutils literal notranslate"><span class="pre">default</span></code> to work with the role service named “default”.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee6.jpeg" src="../../../_images/j2ee6.jpeg" />
</div>
</li>
<li><p>Click on the <code class="docutils literal notranslate"><span class="pre">Roles</span></code> tab.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee7.jpeg" src="../../../_images/j2ee7.jpeg" />
</div>
</li>
<li><p>Click on the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">new</span> <span class="pre">role</span></code> link.</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee8.jpeg" src="../../../_images/j2ee8.jpeg" />
</div>
<ul class="simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">Name</span></code> to “tomcat”</p></li>
</ul>
<div class="figure align-center">
<img alt="../../../_images/j2ee9.jpeg" src="../../../_images/j2ee9.jpeg" />
</div>
</li>
<li><p>Save</p></li>
</ol>
</div>
<div class="section" id="configure-tomcat-for-authentication">
<h2>Configure Tomcat for authentication<a class="headerlink" href="#configure-tomcat-for-authentication" title="Permalink to this headline">¶</a></h2>
<p>By default Tomcat does not require authentication for web applications. In this
section Tomcat will be configured to secure GeoServer requiring a basic authentication
login.</p>
<ol class="arabic">
<li><p>Shut down Tomcat.</p></li>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">conf/tomcat-users.xml</span></code> under the Tomcat root directory and add a user
named “admin”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">user</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="n">roles</span><span class="o">=</span><span class="s2">&quot;tomcat&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
</li>
<li><p>Edit the GeoServer <code class="docutils literal notranslate"><span class="pre">web.xml</span></code> file located at <code class="docutils literal notranslate"><span class="pre">webapps/geoserver/WEB-INF/web.xml</span></code>
under the Tomcat root directory and add the following at the end of the file directly
before the closing <code class="docutils literal notranslate"><span class="pre">&lt;/web-app&gt;</span></code> element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">security</span><span class="o">-</span><span class="n">constraint</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">web</span><span class="o">-</span><span class="n">resource</span><span class="o">-</span><span class="n">collection</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;/*&lt;/</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">http</span><span class="o">-</span><span class="n">method</span><span class="o">&gt;</span><span class="n">GET</span><span class="o">&lt;/</span><span class="n">http</span><span class="o">-</span><span class="n">method</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">http</span><span class="o">-</span><span class="n">method</span><span class="o">&gt;</span><span class="n">POST</span><span class="o">&lt;/</span><span class="n">http</span><span class="o">-</span><span class="n">method</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">web</span><span class="o">-</span><span class="n">resource</span><span class="o">-</span><span class="n">collection</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">auth</span><span class="o">-</span><span class="n">constraint</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">role</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="n">tomcat</span><span class="o">&lt;/</span><span class="n">role</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">auth</span><span class="o">-</span><span class="n">constraint</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">security</span><span class="o">-</span><span class="n">constraint</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">login</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">auth</span><span class="o">-</span><span class="n">method</span><span class="o">&gt;</span><span class="n">BASIC</span><span class="o">&lt;/</span><span class="n">auth</span><span class="o">-</span><span class="n">method</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">login</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Save <code class="docutils literal notranslate"><span class="pre">web.xml</span></code> and restart Tomcat.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is necessary to add all the role names specified in the <code class="docutils literal notranslate"><span class="pre">web.xml</span></code> to the
configured role service. This is duplicate work but there is currently no other solution.</p>
</div>
</div>
<div class="section" id="test-j2ee-login">
<h2>Test J2EE login<a class="headerlink" href="#test-j2ee-login" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Navigate to the GeoServer web admin interface. The result should be a prompt
to authenticate.</p></li>
<li><p>Enter in the username “admin” and password “password”</p>
<div class="figure align-center">
<img alt="../../../_images/j2ee4.jpg" src="../../../_images/j2ee4.jpg" />
</div>
</li>
</ol>
<p>The result should be the admin user logged into the GeoServer web admin.</p>
</div>
</div>


        <div class="selfclear pagination-nav">
            <div class="leftwise"><strong>Previous</strong>: <a href="../cert/index.html" title="previous chapter">Configuring X.509 Certificate Authentication</a></div>
            <div class="rightwise"><strong>Next</strong>: <a href="../httpheaderproxy/index.html" title="next chapter">Configuring HTTP Header Proxy Authentication</a></div>
        </div>
        </div><!-- /#content> -->
        <div id="content-right" class="content-border"></div>
        
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix"><a href="../../../index.html">Table Of Contents</a></h3>
        <ul>
<li><a class="reference internal" href="#">Configuring J2EE Authentication</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#configure-the-j2ee-authentication-filter">Configure the J2EE authentication filter</a></li>
<li><a class="reference internal" href="#configure-the-role-service">Configure the role service</a></li>
<li><a class="reference internal" href="#configure-tomcat-for-authentication">Configure Tomcat for authentication</a></li>
<li><a class="reference internal" href="#test-j2ee-login">Test J2EE login</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="../cert/index.html" title="previous chapter">Configuring X.509 Certificate Authentication</a></li>
            <li>Next: <a href="../httpheaderproxy/index.html" title="next chapter">Configuring HTTP Header Proxy Authentication</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
        
        <li><a href="https://github.com/geoserver/geoserver/tree/main/doc/en/user/source/security/tutorials/j2ee/index.rst">Edit</a></li>
        </ul>
        </div>
      <div class="section">
        <h3>Known GeoServer issues</h3>
        <ul class="this-page-menu">
          <li><a href="https://osgeo-org.atlassian.net/projects/GEOS/summary">Jira issue tracker</a></li>
        </ul>
      </div>
  </div><!-- /#sidebar -->
    </div><!-- /.wrap> -->
  </div><!-- /#main -->
<div id="footer">
    <div class="wrap">
        &copy; Copyright 2023, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
        Last updated on Jun 18, 2023.
        Created using <a href="http://www.sphinx-doc.org/">Sphinx</a>.
    </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>