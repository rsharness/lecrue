
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upgrading &#8212; GeoServer 2.22.4 User Manual</title>
    <link rel="stylesheet" href="../../_static/blueprint/screen.css" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="../../_static/blueprint/print.css" type="text/css" media="print" /> 
    <!--[if IE]>
    <link rel="stylesheet" href="../../_static/blueprint/ie.css" type="text/css" media="screen, projection" />
    <![endif]-->
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/geoserver.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ncWMS WMS extensions support" href="../ncwms/index.html" />
    <link rel="prev" title="Database Persistence" href="db.html" /> 
  </head><body class="community/monitor-hibernate/upgrade">
<div id="header" class="selfclear">
    <div class="wrap selfclear">
        <div id="logo"><a href="http://geoserver.org">GeoServer</a></div>
        <ul id="top-nav">
            <li class="first"><a href="http://geoserver.org/about/">About</a></li>
            <li><a href="http://geoserver.org/blog">Blog</a></li>
            <li><a href="http://geoserver.org/download/">Download</a></li>
            <li><a href="https://docs.geoserver.org/">Documentation</a></li>
        </ul>

        <form id="quick-search" action="../../search.html" method="get">
            <fieldset>
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
                <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" size="20" tabindex="3" placeholder="Search User Manual&hellip;" />
                <input id="quick-search-submit" type="image" value="Search" src="../../_static/chrome/search_icon_green.png" />
            </fieldset>
        </form>
    </div><!-- /.wrap -->
</div><!-- /#header -->
    <div id="main">
      <div class="wrap selfclear">
        <div id="content-left" class="content-border"></div>
        <div id="content">
        
<ul id="breadcrumbs">
  
    <li><a href="../../index.html">GeoServer 2.22.4 User Manual</a> &raquo;</li>
        <li><a href="../index.html" accesskey="U">Community modules</a> &raquo;</li>
        <li><a href="index.html" accesskey="U">Monitoring Hibernate storage</a> &raquo;</li>
    <li>Upgrading</li>
</ul>
        
<ul id="relatedlinks" class="selfclear">
  <li class="first"><a href="../ncwms/index.html" title="ncWMS WMS extensions support" accesskey="N">Next</a></li>
  <li>
    <a href="db.html" title="Database Persistence" accesskey="P">Previous</a>|
  </li>
</ul>
          
  <div class="section" id="upgrading">
<span id="monitor-upgrade"></span><h1>Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h1>
<p>The monitoring extension uses Hibernate to persist request data. Changes to the extension over time affect the structure of
the underlying database, which should be taken into consideration before performing an upgrade. Depending on the nature of
changes in an upgrade, it may involve manually making changes to the underlying database before deploying a new version of
the extension.</p>
<p>The sections below provides a history of such changes, and recommended actions that should be taken as part of the upgrade.
Upgrades are grouped into two categories:</p>
<ul class="simple">
<li><p><strong>minor</strong> upgrades that occur during a minor GeoServer version change, for example going from 2.1.2 to
2.1.3. These changes are backward compatible in that no action is specifically required but potentially
recommended. In these cases performing an upgrade without any action still result in the monitoring
extension continuing to function.</p></li>
<li><p><strong>major</strong> upgrades that occur during a major GeoServer version change, for example going from 2.1.2 to
2.2.0. These changes <em>may</em> be backward compatible, but not necessarily. In these cases performing an upgrade
without any action could potentially result in the monitoring extension ceasing to function, and may result
in significant changes to the underlying database.</p></li>
</ul>
<p>For each change the following information is maintained:</p>
<ul class="simple">
<li><p>The released version containing the change</p></li>
<li><p>The date of the change</p></li>
<li><p>The subversion revision of the change</p></li>
<li><p>The jira issue referring to the change</p></li>
</ul>
<p>The date and subversion revision are especially useful if a nightly build of the extension is being used.</p>
<div class="section" id="minor-upgrades">
<h2>Minor upgrades<a class="headerlink" href="#minor-upgrades" title="Permalink to this headline">¶</a></h2>
<div class="section" id="column-resource-renamed-to-name-in-request-resources-table">
<h3>Column <code class="docutils literal notranslate"><span class="pre">resource</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">name</span></code> in <code class="docutils literal notranslate"><span class="pre">request_resources</span></code> table<a class="headerlink" href="#column-resource-renamed-to-name-in-request-resources-table" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><em>Version</em>: n/a, extension still community status</p></li>
<li><p><em>Date</em>: Dec 09, 2011</p></li>
<li><p><em>Subversion revision</em>: 16632</p></li>
<li><p><em>Reference</em>: <a class="reference external" href="https://osgeo-org.atlassian.net/browse/GEOS-4871">GEOS-4871</a></p></li>
</ul>
<p>Upgrading without performing any action will result in the <code class="docutils literal notranslate"><span class="pre">name</span></code> column being added to the <code class="docutils literal notranslate"><span class="pre">request_resources</span></code> table,
leaving the <code class="docutils literal notranslate"><span class="pre">resource</span></code> column intact. From that point forward the <code class="docutils literal notranslate"><span class="pre">resource</span></code> column will essentially be ignored.
However no data from the <code class="docutils literal notranslate"><span class="pre">resource</span></code> column will be migrated, which will throw off reports, resource access statistics,
etc… If you wish to migrate the data perform one of the following actions two actions.</p>
<p>The first is a <em>pre</em> upgrade action that involves simply renaming the column before deploying the new monitoring
extension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">request_resources</span> <span class="n">RENAME</span> <span class="n">COLUMN</span> <span class="n">resource</span> <span class="n">to</span> <span class="n">name</span><span class="p">;</span>
</pre></div>
</div>
<p>Alternatively the migration may occur <em>post</em> upgrade:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">TABLE</span> <span class="n">request_resources</span> <span class="n">SET</span> <span class="n">name</span> <span class="o">=</span> <span class="n">resource</span> <span class="n">where</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">NULL</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">request_resources</span> <span class="n">DROP</span> <span class="n">COLUMN</span> <span class="n">resource</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="column-remote-user-agent-added-to-request-table">
<h3>Column <code class="docutils literal notranslate"><span class="pre">remote_user_agent</span></code> added to <code class="docutils literal notranslate"><span class="pre">request</span></code> table<a class="headerlink" href="#column-remote-user-agent-added-to-request-table" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><em>Version</em>: n/a, extension still community status</p></li>
<li><p><em>Date</em>: Dec 09, 2011</p></li>
<li><p><em>Subversion revision</em>: 16634</p></li>
<li><p><em>Reference</em>: <a class="reference external" href="https://osgeo-org.atlassian.net/browse/GEOS-4872">GEOS-4872</a></p></li>
</ul>
<p>No action should be required here as Hibernate will simply append the new column to the table. If for some reason this does
not happen the column can be added manually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">request</span> <span class="n">ADD</span> <span class="n">COLUMN</span> <span class="n">remote_user_agent</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="major-upgrades">
<h2>Major upgrades<a class="headerlink" href="#major-upgrades" title="Permalink to this headline">¶</a></h2>
</div>
</div>


        <div class="selfclear pagination-nav">
            <div class="leftwise"><strong>Previous</strong>: <a href="db.html" title="previous chapter">Database Persistence</a></div>
            <div class="rightwise"><strong>Next</strong>: <a href="../ncwms/index.html" title="next chapter">ncWMS WMS extensions support</a></div>
        </div>
        </div><!-- /#content> -->
        <div id="content-right" class="content-border"></div>
        
  <div id="sidebar" class="contrast">
      <div id="toc" class="section">
        <h3 class="pngfix"><a href="../../index.html">Table Of Contents</a></h3>
        <ul>
<li><a class="reference internal" href="#">Upgrading</a><ul>
<li><a class="reference internal" href="#minor-upgrades">Minor upgrades</a><ul>
<li><a class="reference internal" href="#column-resource-renamed-to-name-in-request-resources-table">Column <code class="docutils literal notranslate"><span class="pre">resource</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">name</span></code> in <code class="docutils literal notranslate"><span class="pre">request_resources</span></code> table</a></li>
<li><a class="reference internal" href="#column-remote-user-agent-added-to-request-table">Column <code class="docutils literal notranslate"><span class="pre">remote_user_agent</span></code> added to <code class="docutils literal notranslate"><span class="pre">request</span></code> table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#major-upgrades">Major upgrades</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="db.html" title="previous chapter">Database Persistence</a></li>
            <li>Next: <a href="../ncwms/index.html" title="next chapter">ncWMS WMS extensions support</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
        
        <li><a href="https://github.com/geoserver/geoserver/tree/main/doc/en/user/source/community/monitor-hibernate/upgrade.rst">Edit</a></li>
        </ul>
        </div>
      <div class="section">
        <h3>Known GeoServer issues</h3>
        <ul class="this-page-menu">
          <li><a href="https://osgeo-org.atlassian.net/projects/GEOS/summary">Jira issue tracker</a></li>
        </ul>
      </div>
  </div><!-- /#sidebar -->
    </div><!-- /.wrap> -->
  </div><!-- /#main -->
<div id="footer">
    <div class="wrap">
        &copy; Copyright 2023, Open Source Geospatial Foundation. License <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution</a>.
        Last updated on Jun 18, 2023.
        Created using <a href="http://www.sphinx-doc.org/">Sphinx</a>.
    </div><!-- /.wrap> -->
</div><!-- /#footer -->
  </body>
</html>